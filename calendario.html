<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>EMSI ä¸­è¥¿åˆç’§æ ¡å†å¤‡å¿˜å½•</title>
    <style>
        /* --- EMSI æ ¸å¿ƒè§†è§‰é£æ ¼ --- */
        body { margin: 0; padding: 0; font-family: 'Segoe UI', 'PingFang SC', sans-serif; background-color: #f5f7fa; display: flex; flex-direction: column; min-height: 100vh; }
        .header { background-color: white; text-align: center; padding: 35px 20px 10px; border-bottom: 5px solid #f1c40f; }
        .header h1 { color: #1a4a8e; font-size: 32px; margin: 0; letter-spacing: 2px; }
        .header h1 span { font-weight: 800; }
        .header .subtitle { color: #6b7280; font-size: 16px; margin: 8px 0 20px 0; }

        /* --- é¡¶éƒ¨æ§åˆ¶æ  --- */
        .toolbar { width: 100%; max-width: 1250px; margin: 20px auto; display: flex; gap: 15px; padding: 0 20px; box-sizing: border-box; }
        .btn-home { display: inline-flex; align-items: center; padding: 10px 25px; background-color: white; color: #1a4a8e; text-decoration: none; border-radius: 50px; font-size: 18px; font-weight: 600; box-shadow: 0 4px 12px rgba(0,0,0,0.08); border: 1px solid #e2e8f0; }
        .btn-home::before { content: "â†"; margin-right: 10px; font-weight: bold; }

        .main-grid { display: grid; grid-template-columns: 500px 1fr; gap: 20px; width: 100%; max-width: 1250px; margin: 0 auto 40px auto; padding: 0 20px; box-sizing: border-box; }

        /* --- æ—¥å†æ ·å¼ --- */
        .card { background: white; border-radius: 15px; box-shadow: 0 4px 15px rgba(0,0,0,0.05); padding: 20px; border: 1px solid #eee; display: flex; flex-direction: column; }
        .calendar-title { color: #1a4a8e; font-size: 22px; font-weight: 800; margin-bottom: 15px; display: flex; justify-content: space-between; align-items: center; }
        .calendar-grid { display: grid; grid-template-columns: repeat(7, 1fr); gap: 1px; text-align: center; border: 1px solid #edf2f7; background: #edf2f7; }
        
        .day-name { font-size: 13px; font-weight: bold; color: #94a3b8; padding: 10px 0; background: #f8fafc; }
        
        .day { height: 75px; display: flex; flex-direction: column; justify-content: center; background: white; position: relative; }
        .solar-num { font-size: 18px; font-weight: 600; color: #334155; }
        .lunar-text { font-size: 11px; color: #94a3b8; margin-top: 3px; }

        /* çŠ¶æ€é¢œè‰² */
        .today { background: #1a4a8e !important; color: white !important; }
        .today .lunar-text { color: #cbd5e1; }
        
        .holiday-es { background: #fee2e2; } /* è¥¿è¯­å‡æœŸçº¢è‰²èƒŒæ™¯ */
        .holiday-es .solar-num { color: #ef4444; }
        
        .holiday-cn { background: #fff7ed; } /* ä¸­å›½èŠ‚æ—¥æ©™è‰²æ–‡å­— */
        .holiday-cn .lunar-text { color: #f97316; font-weight: bold; }

        /* --- å¤‡å¿˜å½•æ ·å¼ --- */
        .memo-input-area { margin-bottom: 20px; display: flex; flex-direction: column; gap: 10px; }
        textarea { width: 100%; height: 110px; padding: 15px; border: 1px solid #d1d5db; border-radius: 12px; resize: none; font-size: 16px; font-family: inherit; box-sizing: border-box; }
        
        .btn-group { display: flex; gap: 10px; }
        .btn { padding: 12px 20px; border: none; border-radius: 8px; cursor: pointer; font-weight: 600; transition: 0.2s; }
        .btn-blue { background: #1a4a8e; color: white; }
        .btn-green { background: #27ae60; color: white; }
        .btn-gray { background: #64748b; color: white; }

        .memo-item { background: #f8fafc; border-left: 5px solid #1a4a8e; padding: 18px; border-radius: 8px; margin-bottom: 12px; box-shadow: 0 2px 5px rgba(0,0,0,0.03); }
        .memo-content { margin-bottom: 10px; color: #1e293b; line-height: 1.6; white-space: pre-wrap; outline: none; }
        .memo-footer { font-size: 12px; color: #94a3b8; display: flex; justify-content: space-between; align-items: center; border-top: 1px solid #eee; padding-top: 10px; }
        .btn-del { color: #ef4444; cursor: pointer; font-weight: bold; }

        .footer { background: #1a4a8e; color: white; text-align: center; padding: 20px; font-size: 14px; }
    </style>
</head>
<body>

    <header class="header">
        <h1><span>EMSI</span> 2026 æ ¡å†å¤‡å¿˜å½•</h1>
        <div class="subtitle">é©¬å¾·é‡Œå‡æœŸ & å†œå†æ—¥æœŸ (AÃ±o- Chino)</div>
    </header>

    <div class="toolbar">
        <a href="index.html" class="btn-home">è¿”å›é¦–é¡µ</a>
    </div>

    <main class="main-grid">
        <div class="card">
            <div class="calendar-title">
                <span id="monthYear">2026å¹´ 1æœˆ</span>
                <div style="display:flex; gap:10px;">
                    <button onclick="changeMonth(-1)">â—€ ä¸Šæœˆ</button>
                    <button onclick="changeMonth(1)">ä¸‹æœˆ â–¶</button>
                </div>
            </div>
            <div class="calendar-grid" id="calendarBody"></div>
            
            <div id="holidayDisplay" style="margin-top:20px; font-size:13px; background:#f8fafc; padding:15px; border-radius:10px;">
                <strong>ğŸ’¡ æœ¬æœˆæç¤º:</strong>
                <div id="holidayItems" style="margin-top:5px; color:#475569; line-height:1.6;"></div>
            </div>
        </div>

        <div class="card">
            <div class="memo-input-area">
                <textarea id="memoInput" placeholder="è¾“å…¥æ–°çš„æ•™å­¦å¤‡å¿˜ã€ä¼šè®®è®°å½•æˆ–å‡æœŸå®‰æ’..."></textarea>
                <div class="btn-group">
                    <button class="btn btn-blue" onclick="addMemo()">+ æ·»åŠ å¤‡å¿˜</button>
                    <button class="btn btn-green" onclick="manualSave()">ğŸ’¾ ç«‹å³ä¿å­˜</button>
                    <button class="btn btn-gray" style="margin-left:auto;" onclick="exportCSV()">ğŸ“¥ å¯¼å‡ºæ•°æ®</button>
                </div>
            </div>
            <div id="memoList"></div>
        </div>
    </main>

    <footer class="footer">
        Â© 2026 EMSI é©¬å¾·é‡Œå›½é™…ä¸­æ–‡å­¦æ ¡ | EducaciÃ³n para un futuro mejor
    </footer>

    <script>
        // --- 2026 å†œå†ä¸å‡æœŸåº•å±‚æ•°æ® ---
        // 2026å¹´å„å†œå†æœˆåˆå¯¹åº”çš„å…¬å†æ—¥æœŸ (ç”¨äºæ¨ç®—åˆå‡ )
        const lunarMonths2026 = [
            { solar: "2026-01-19", name: "è…Šæœˆ" },
            { solar: "2026-02-17", name: "æ­£æœˆ" }, // æ˜¥èŠ‚
            { solar: "2026-03-19", name: "äºŒæœˆ" },
            { solar: "2026-04-17", name: "ä¸‰æœˆ" },
            { solar: "2026-05-16", name: "å››æœˆ" },
            { solar: "2026-06-15", name: "äº”æœˆ" },
            { solar: "2026-07-14", name: "å…­æœˆ" },
            { solar: "2026-08-12", name: "ä¸ƒæœˆ" },
            { solar: "2026-09-11", name: "å…«æœˆ" },
            { solar: "2026-10-10", name: "ä¹æœˆ" },
            { solar: "2026-11-09", name: "åæœˆ" },
            { solar: "2026-12-09", name: "å†¬æœˆ" }
        ];

        const festivals = {
            "1-1": { es: "æ–°å¹´", cn: "å…ƒæ—¦" },
            "1-6": { es: "ä¸‰ç‹èŠ‚" },
            "2-17": { cn: "æ˜¥èŠ‚" },
            "2-18": { cn: "åˆäºŒ" },
            "2-19": { cn: "åˆä¸‰" },
            "3-3": { cn: "å…ƒå®µèŠ‚" },
            "3-19": { es: "åœ£è‹¥ç‘ŸèŠ‚" },
            "4-2": { es: "å¤æ´»èŠ‚å‘¨å››" },
            "4-3": { es: "å¤æ´»èŠ‚å‘¨äº”" },
            "4-5": { cn: "æ¸…æ˜" },
            "5-1": { es: "åŠ³åŠ¨èŠ‚" },
            "5-2": { es: "é©¬å¾·é‡Œæ—¥" },
            "5-15": { es: "åœ£ä¼Šè¥¿å¾·ç½—èŠ‚" },
            "6-19": { cn: "ç«¯åˆèŠ‚" },
            "8-15": { es: "åœ£æ¯å‡å¤©èŠ‚" },
            "9-25": { cn: "ä¸­ç§‹èŠ‚" },
            "10-1": { cn: "å›½åº†èŠ‚" },
            "10-12": { es: "å›½åº†èŠ‚", cn: "é‡é˜³èŠ‚" },
            "11-1": { es: "ä¸‡åœ£èŠ‚" },
            "11-9": { es: "é©¬å¾·é‡Œåœ£æ¯æ—¥" },
            "12-6": { es: "å®ªæ³•æ—¥" },
            "12-8": { es: "åœ£æ¯æ— æŸ“æ—¥" },
            "12-25": { es: "åœ£è¯èŠ‚" }
        };

        const MEMO_KEY = 'EMSI_MEMO_2026_PRO';
        let memos = JSON.parse(localStorage.getItem(MEMO_KEY)) || [];
        let currentNavDate = new Date(2026, 0, 1);

        function init() { renderCalendar(); renderMemos(); }

        // --- å†œå†è®¡ç®—é€»è¾‘ ---
        function getLunarDate(y, m, d) {
            const dateStr = `${y}-${(m+1).toString().padStart(2,'0')}-${d.toString().padStart(2,'0')}`;
            const target = new Date(dateStr);
            
            // æ‰¾åˆ°æœ€æ¥è¿‘ä¸”å°äºå½“å‰æ—¥æœŸçš„å†œå†æœˆåˆ
            let activeMonth = { solar: "2025-12-20", name: "å†¬æœˆ" }; // å…œåº•
            for(let i=0; i<lunarMonths2026.length; i++) {
                if(new Date(lunarMonths2026[i].solar) <= target) {
                    activeMonth = lunarMonths2026[i];
                }
            }

            const diffTime = target - new Date(activeMonth.solar);
            const diffDays = Math.ceil(diffTime / (1000 * 60 * 60 * 24)) + 1;
            
            if (diffDays === 1) return activeMonth.name;
            const chineseNums = ["", "ä¸€", "äºŒ", "ä¸‰", "å››", "äº”", "å…­", "ä¸ƒ", "å…«", "ä¹", "å"];
            if (diffDays <= 10) return "åˆ" + chineseNums[diffDays];
            if (diffDays < 20) return "å" + chineseNums[diffDays - 10];
            if (diffDays === 20) return "äºŒå";
            if (diffDays < 30) return "å»¿" + chineseNums[diffDays - 20];
            return "ä¸‰å";
        }

        // --- æ ¸å¿ƒæ¸²æŸ“ ---
        function renderCalendar() {
            const year = currentNavDate.getFullYear();
            const month = currentNavDate.getMonth();
            document.getElementById('monthYear').innerText = `${year}å¹´ ${month + 1}æœˆ`;

            const firstDay = new Date(year, month, 1).getDay();
            const daysInMonth = new Date(year, month + 1, 0).getDate();
            const calBody = document.getElementById('calendarBody');
            calBody.innerHTML = '';

            ['æ—¥','ä¸€','äºŒ','ä¸‰','å››','äº”','å…­'].forEach(d => calBody.innerHTML += `<div class="day-name">${d}</div>`);
            for (let i = 0; i < firstDay; i++) calBody.innerHTML += `<div></div>`;

            const holidayItems = [];
            const today = new Date();

            for (let d = 1; d <= daysInMonth; d++) {
                const key = `${month + 1}-${d}`;
                const festival = festivals[key];
                const lunar = getLunarDate(year, month, d);
                
                let classes = 'day';
                let displayLunar = lunar;

                if (festival) {
                    if (festival.es) classes += ' holiday-es';
                    if (festival.cn) {
                        classes += ' holiday-cn';
                        displayLunar = festival.cn; // èŠ‚æ—¥ä¼˜å…ˆäºæ—¥æœŸæ˜¾ç¤º
                    }
                    holidayItems.push(`<span>${d}æ—¥: ${festival.cn || ''} ${festival.es || ''}</span>`);
                }

                if (year === today.getFullYear() && month === today.getMonth() && d === today.getDate()) classes += ' today';

                calBody.innerHTML += `
                    <div class="${classes}">
                        <span class="solar-num">${d}</span>
                        <span class="lunar-text">${displayLunar}</span>
                    </div>`;
            }
            document.getElementById('holidayItems').innerHTML = holidayItems.join(' | ') || 'æœ¬æœˆæš‚æ— ç‰¹æ®ŠèŠ‚å‡æ—¥';
        }

        function changeMonth(step) { currentNavDate.setMonth(currentNavDate.getMonth() + step); renderCalendar(); }

        // --- å¤‡å¿˜å½•ç®¡ç† ---
        function addMemo() {
            const input = document.getElementById('memoInput');
            if (!input.value.trim()) return;
            memos.unshift({ id: Date.now(), text: input.value, time: new Date().toLocaleString() });
            input.value = '';
            save(); renderMemos();
        }

        function deleteMemo(id) {
            if (confirm("ç¡®å®šè¦åˆ é™¤è¿™æ¡è®°å½•å—ï¼Ÿ")) {
                memos = memos.filter(m => m.id !== id);
                save(); renderMemos();
            }
        }

        function updateMemo(id, text) {
            const m = memos.find(x => x.id === id);
            if (m) { m.text = text; save(); }
        }

        function save() { localStorage.setItem(MEMO_KEY, JSON.stringify(memos)); }
        function manualSave() { save(); alert("âœ… å¤‡å¿˜å½•å·²å®‰å…¨ä¿å­˜ï¼"); }

        function renderMemos() {
            const container = document.getElementById('memoList');
            if (!memos.length) { container.innerHTML = '<div style="text-align:center;color:#999;padding:40px;">ğŸ“‚ å°šæ— å¤‡å¿˜å†…å®¹</div>'; return; }
            container.innerHTML = memos.map(m => `
                <div class="memo-item">
                    <div class="memo-content" contenteditable="true" onblur="updateMemo(${m.id}, this.innerText)">${m.text}</div>
                    <div class="memo-footer">
                        <span>${m.time}</span>
                        <span class="btn-del" onclick="deleteMemo(${m.id})">åˆ é™¤</span>
                    </div>
                </div>`).join('');
        }

        function exportCSV() {
            let csv = "\uFEFFå†…å®¹,æ—¶é—´\n";
            memos.forEach(m => csv += `"${m.text.replace(/"/g, '""')}","${m.time}"\n`);
            const blob = new Blob([csv], { type: 'text/csv;charset=utf-8;' });
            const a = document.createElement('a');
            a.href = URL.createObjectURL(blob);
            a.download = `EMSIå¤‡å¿˜å½•_${new Date().toLocaleDateString()}.csv`;
            a.click();
        }

        init();
    </script>
</body>
</html>