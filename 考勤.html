<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>EMSI è€ƒå‹¤ç™»è®° - é©¬å¾·é‡Œå›½é™…ä¸­æ–‡å­¦æ ¡</title>
    <style>
        /* --- åŸºç¡€æ ·å¼ --- */
        body {
            margin: 0;
            padding: 0;
            font-family: 'Segoe UI', 'PingFang SC', -apple-system, sans-serif;
            background-color: #f5f7fa; 
            display: flex;
            flex-direction: column;
            min-height: 100vh;
        }

        /* --- é¡µçœ‰ --- */
        .header {
            background-color: white;
            text-align: center;
            padding: 40px 20px 0 20px;
            border-bottom: 5px solid #f1c40f; 
        }

        .header h1 {
            color: #1a4a8e; 
            font-size: 42px;
            font-weight: 600;
            margin: 0;
            letter-spacing: 2px;
        }

        .header h1 span { font-weight: 800; margin-right: 15px; }

        .header .subtitle {
            color: #6b7280; 
            font-size: 20px;
            margin-top: 10px;
            margin-bottom: 25px;
        }

        /* --- é¡¶éƒ¨æ§åˆ¶æ  --- */
        .toolbar {
            width: 100%;
            max-width: 1100px;
            margin: 20px auto;
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            padding: 0 20px;
            box-sizing: border-box;
            gap: 15px;
            flex-wrap: wrap;
        }

        .btn-home {
            display: inline-flex;
            align-items: center;
            padding: 8px 25px;
            background-color: white;
            color: #1a4a8e;
            text-decoration: none;
            border-radius: 50px;
            font-size: 18px;
            font-weight: 600;
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
            border: 1px solid #e0e0e0;
        }

        /* ç®¡ç†åŒºåŸŸå®¹å™¨ */
        .mgmt-panel {
            background: #fff;
            padding: 15px;
            border-radius: 12px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.05);
            display: flex;
            flex-direction: column;
            gap: 10px;
            flex: 1;
            min-width: 300px;
        }

        .input-group { display: flex; gap: 8px; align-items: center; flex-wrap: wrap; }

        .input-field {
            padding: 8px 12px;
            border: 1px solid #ddd;
            border-radius: 6px;
            outline: none;
        }

        .btn-action {
            padding: 8px 16px;
            border-radius: 6px;
            border: none;
            cursor: pointer;
            font-weight: 600;
            transition: 0.2s;
        }

        .btn-blue { background-color: #1a4a8e; color: white; }
        .btn-green { background-color: #27ae60; color: white; }
        .btn-orange { background-color: #f39c12; color: white; }

        /* --- å†…å®¹å±•ç¤ºåŒº --- */
        .main-content { flex: 1; padding: 0 20px 40px 20px; display: flex; justify-content: center; }

        .card {
            background: white;
            width: 100%;
            max-width: 1100px;
            border-radius: 20px;
            box-shadow: 0 10px 25px rgba(0,0,0,0.05);
            padding: 25px;
            border: 1px solid #eee;
        }

        /* ç­çº§åˆ†å‰²æ ‡é¢˜æ ·å¼ */
        .class-divider {
            background-color: #f8fafc;
            color: #1a4a8e;
            padding: 10px 15px;
            font-weight: 800;
            font-size: 18px;
            border-left: 5px solid #f1c40f;
            margin: 20px 0 10px 0;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .btn-del-class {
            font-size: 12px;
            color: #e74c3c;
            cursor: pointer;
            font-weight: normal;
        }

        table { width: 100%; border-collapse: collapse; margin-bottom: 30px; }
        th { text-align: left; padding: 12px; border-bottom: 2px solid #eee; color: #64748b; font-size: 14px; }
        td { padding: 12px; border-bottom: 1px solid #f1f5f9; }

        /* æ ‡ç­¾ */
        .tag { font-size: 11px; padding: 2px 6px; border-radius: 4px; margin-left: 5px; }
        .tag-fixed { background-color: #e1effe; color: #1e429f; }
        .tag-temp { background-color: #fef3c7; color: #92400e; }

        .status-options { display: flex; gap: 10px; flex-wrap: wrap; }
        label { font-size: 13px; color: #4b5563; cursor: pointer; display: flex; align-items: center; gap: 3px; }

        .btn-delete-stu { color: #e74c3c; cursor: pointer; font-size: 13px; }

        .footer { background-color: #1a4a8e; color: white; text-align: center; padding: 18px 20px; }
    </style>
</head>
<body>

    <header class="header">
        <h1><span>EMSI</span> é©¬å¾·é‡Œå›½é™…ä¸­æ–‡å­¦æ ¡</h1>
        <div class="subtitle">å­¦ç”Ÿç­çº§è€ƒå‹¤ç®¡ç†ç³»ç»Ÿ</div>
    </header>

    <div class="toolbar">
        <a href="index.html" class="btn-home">â† è¿”å›é¦–é¡µ</a>
        
        <div class="mgmt-panel">
            <div class="input-group">
                <strong>1. ç­çº§ç®¡ç†:</strong>
                <input type="text" id="classNameInput" class="input-field" placeholder="æ–°ç­çº§åç§°">
                <button class="btn-action btn-orange" onclick="addClass()">åˆ›å»ºç­çº§</button>
            </div>
            
            <hr style="width: 100%; border: 0.5px solid #eee;">

            <div class="input-group">
                <strong>2. æ·»åŠ å­¦ç”Ÿ:</strong>
                <input type="text" id="stuNameInput" class="input-field" placeholder="å­¦ç”Ÿå§“å" style="width:100px;">
                <select id="stuClassSelect" class="input-field"></select>
                <select id="stuTypeSelect" class="input-field">
                    <option value="å›ºå®šç­çº§">å›ºå®šç­çº§</option>
                    <option value="ä¸´æ—¶å­¦ç”Ÿ">ä¸´æ—¶å­¦ç”Ÿ</option>
                </select>
                <button class="btn-action btn-blue" onclick="addStudent()">ç¡®è®¤æ·»åŠ </button>
                <button class="btn-action btn-green" style="margin-left: auto;" onclick="exportCSV()">ğŸ“¥ å¯¼å‡ºè€ƒå‹¤è¡¨</button>
            </div>
        </div>
    </div>

    <main class="main-content">
        <div class="card" id="tablesContainer">
            </div>
    </main>

    <footer class="footer">
        <span>Â© 2026 EMSI é©¬å¾·é‡Œå›½é™…ä¸­æ–‡å­¦æ ¡ | EducaciÃ³n para un futuro mejor</span>
    </footer>

    <script>
        // æ•°æ®ç»“æ„
        // classes: ["ç­çº§A", "ç­çº§B"]
        // students: [{name: "å¼ ä¸‰", class: "ç­çº§A", type: "å›ºå®šç­çº§"}]
        let classes = JSON.parse(localStorage.getItem('emsi_classes')) || ["æœªåˆ†é…ç­çº§"];
        let students = JSON.parse(localStorage.getItem('emsi_students_v2')) || [];

        // åˆå§‹åŒ–æ¸²æŸ“
        function init() {
            renderClassSelect();
            renderTables();
        }

        // æ¸²æŸ“ç­çº§ä¸‹æ‹‰æ¡†
        function renderClassSelect() {
            const select = document.getElementById('stuClassSelect');
            select.innerHTML = classes.map(c => `<option value="${c}">${c}</option>`).join('');
        }

        // æ·»åŠ ç­çº§
        function addClass() {
            const input = document.getElementById('classNameInput');
            const name = input.value.trim();
            if (name && !classes.includes(name)) {
                classes.push(name);
                localStorage.setItem('emsi_classes', JSON.stringify(classes));
                input.value = '';
                renderClassSelect();
                renderTables();
            }
        }

        // åˆ é™¤ç­çº§
        function deleteClass(className) {
            if (confirm(`ç¡®å®šåˆ é™¤ç­çº§ [${className}] å—ï¼Ÿè¯¥ç­çº§ä¸‹çš„å­¦ç”Ÿå°†ç§»è‡³â€œæœªåˆ†é…ç­çº§â€ã€‚`)) {
                students.forEach(s => { if(s.class === className) s.class = "æœªåˆ†é…ç­çº§"; });
                classes = classes.filter(c => c !== className);
                if (classes.length === 0) classes.push("æœªåˆ†é…ç­çº§");
                saveData();
            }
        }

        // æ·»åŠ å­¦ç”Ÿ
        function addStudent() {
            const nameInput = document.getElementById('stuNameInput');
            const name = nameInput.value.trim();
            const className = document.getElementById('stuClassSelect').value;
            const type = document.getElementById('stuTypeSelect').value;

            if (name) {
                students.push({ name, class: className, type });
                sortStudents();
                saveData();
                nameInput.value = '';
                nameInput.focus();
            }
        }

        // æ’åºé€»è¾‘ï¼šç±»å‹ä¼˜å…ˆï¼Œç„¶åæ‹¼éŸ³
        function sortStudents() {
            students.sort((a, b) => {
                if (a.type !== b.type) return a.type === "å›ºå®šç­çº§" ? -1 : 1;
                return a.name.localeCompare(b.name, 'zh');
            });
        }

        function removeStudent(index) {
            if (confirm("ç¡®å®šåˆ é™¤è¯¥å­¦ç”Ÿå—ï¼Ÿ")) {
                students.splice(index, 1);
                saveData();
            }
        }

        function saveData() {
            localStorage.setItem('emsi_classes', JSON.stringify(classes));
            localStorage.setItem('emsi_students_v2', JSON.stringify(students));
            renderTables();
            renderClassSelect();
        }

        // æ ¸å¿ƒæ¸²æŸ“ï¼šæŒ‰ç­çº§åˆ†ç»„ç”Ÿæˆè¡¨æ ¼
        function renderTables() {
            const container = document.getElementById('tablesContainer');
            container.innerHTML = '';

            if (students.length === 0 && classes.length <= 1) {
                container.innerHTML = '<div style="text-align:center; color:#ccc; padding:50px;">æš‚æ— æ•°æ®ï¼Œè¯·å…ˆåˆ›å»ºç­çº§æˆ–æ·»åŠ å­¦ç”Ÿ</div>';
                return;
            }

            classes.forEach(cls => {
                const classStudents = students.filter(s => s.class === cls);
                
                // åˆ›å»ºç­çº§å¤´éƒ¨
                const divider = document.createElement('div');
                divider.className = 'class-divider';
                divider.innerHTML = `
                    <span>ğŸ“ ${cls} <small style="font-weight:normal; font-size:12px; margin-left:10px;">(${classStudents.length}äºº)</small></span>
                    ${cls !== "æœªåˆ†é…ç­çº§" ? `<span class="btn-del-class" onclick="deleteClass('${cls}')">åˆ é™¤ç­çº§</span>` : ''}
                `;
                container.appendChild(divider);

                // åˆ›å»ºè¯¥ç­çº§çš„è¡¨æ ¼
                const table = document.createElement('table');
                table.innerHTML = `
                    <thead>
                        <tr>
                            <th style="width:25%">å­¦ç”Ÿå§“å</th>
                            <th style="width:65%">è€ƒå‹¤çŠ¶æ€</th>
                            <th style="width:10%">æ“ä½œ</th>
                        </tr>
                    </thead>
                    <tbody>
                        ${classStudents.map(s => {
                            // åœ¨åŸå§‹æ•°ç»„ä¸­æ‰¾åˆ°è¿™ä¸ªå­¦ç”Ÿçš„ç´¢å¼•
                            const originalIndex = students.indexOf(s);
                            return `
                                <tr>
                                    <td>
                                        <strong>${s.name}</strong>
                                        <span class="tag ${s.type === 'å›ºå®šç­çº§' ? 'tag-fixed' : 'tag-temp'}">${s.type}</span>
                                    </td>
                                    <td>
                                        <div class="status-options">
                                            <label><input type="radio" name="status-${originalIndex}" value="å‡ºå¸­" checked>å‡ºå¸­</label>
                                            <label><input type="radio" name="status-${originalIndex}" value="æœªå‡ºå¸­">æœªå‡ºå¸­</label>
                                            <label><input type="radio" name="status-${originalIndex}" value="è¯·å‡">è¯·å‡</label>
                                            <label><input type="radio" name="status-${originalIndex}" value="å›ºå®šä¸æ¥">å›ºå®šä¸æ¥</label>
                                        </div>
                                    </td>
                                    <td><span class="btn-delete-stu" onclick="removeStudent(${originalIndex})">åˆ é™¤</span></td>
                                </tr>
                            `;
                        }).join('')}
                    </tbody>
                `;
                container.appendChild(table);
            });
        }

        // å¯¼å‡º CSV
        function exportCSV() {
            if (students.length === 0) return alert("æ²¡æœ‰å­¦ç”Ÿæ•°æ®");
            const today = new Date().toLocaleDateString();
            let csv = "\uFEFFç­çº§,å§“å,ç±»å‹,è€ƒå‹¤çŠ¶æ€,æ—¥æœŸ\n";
            
            students.forEach((s, index) => {
                const radios = document.getElementsByName(`status-${index}`);
                let status = "å‡ºå¸­";
                for(let r of radios) { if(r.checked) status = r.value; }
                csv += `${s.class},${s.name},${s.type},${status},${today}\n`;
            });

            const blob = new Blob([csv], { type: 'text/csv;charset=utf-8;' });
            const link = document.createElement("a");
            link.href = URL.createObjectURL(blob);
            link.download = `EMSI_å…¨æ ¡è€ƒå‹¤_${today.replace(/\//g, '-')}.csv`;
            link.click();
        }

        // å›è½¦æ”¯æŒ
        document.getElementById('stuNameInput').addEventListener('keypress', e => { if(e.key === 'Enter') addStudent(); });
        document.getElementById('classNameInput').addEventListener('keypress', e => { if(e.key === 'Enter') addClass(); });

        init();
    </script>
</body>
</html>